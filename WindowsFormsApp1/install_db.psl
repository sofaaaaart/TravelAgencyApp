# === 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–∏ SQL Server Express ===
$instanceName = "SQLEXPRESS"
$instancePath = "C:\Program Files\Microsoft SQL Server\"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è SQL Server
if (!(Test-Path "$instancePath\MSSQL$instanceName")) {
    Write-Host "üîπ SQL Server Express –Ω–µ –Ω–∞–π–¥–µ–Ω, –Ω–∞—á–∏–Ω–∞–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É..."
    
    # === 2. –°–∫–∞—á–∏–≤–∞–µ–º –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º SQL Server Express ===
    $sqlInstaller = "https://go.microsoft.com/fwlink/?linkid=866658"
    $downloadPath = "$env:TEMP\SQLServerExpress.exe"
    Invoke-WebRequest -Uri $sqlInstaller -OutFile $downloadPath

    try {
        Start-Process -FilePath $downloadPath -ArgumentList "/QS /IACCEPTSQLSERVERLICENSETERMS /ACTION=Install /FEATURES=SQL /INSTANCENAME=$instanceName /TCPENABLED=1 /NPENABLED=1 /SECURITYMODE=SQL /SAPWD=YourStrongPassword" -Wait
        Write-Host "‚úÖ SQL Server Express —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
    } catch {
        Write-Host "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ SQL Server Express: $_"
        exit 1
    }
} else {
    Write-Host "‚úÖ SQL Server —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω."
}

# === 3. –ó–∞–≥—Ä—É–∂–∞–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏–∑ database.sql ===
Write-Host "üîπ –ó–∞–≥—Ä—É–∂–∞–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö..."
$sqlcmdPath = "C:\Program Files\Microsoft SQL Server\Client SDK\ODBC\170\Tools\Binn\sqlcmd.exe"
if (!(Test-Path $sqlcmdPath)) {
    Write-Host "‚ùå SQLCMD –Ω–µ –Ω–∞–π–¥–µ–Ω, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω SQL Server."
    exit 1
}

$databaseScript = "database.sql"
try {
    & $sqlcmdPath -S "(localdb)\MSSQLLocalDB" -i $databaseScript
    Write-Host "‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!"
} catch {
    Write-Host "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: $_"
    exit 1
}